<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bs-custom-file-input/dist/bs-custom-file-input.min.js"></script>
    <script src="javascriptLCB.js"></script>
    <!-- Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Font+Name">
    <style>@import url('https://fonts.googleapis.com/css?family=Amaranth|Baloo|Cairo|Freckle+Face|Itim&display=swap');</style>
            
    <title>Ajout d'une recette</title>
</head>

<body>

     <!-- NAVBAR top -->
     <nav class="navbar navbartop navbar-expand-sm navbar-light">
         <a href="index.html" class="navbar-brand">
             <img src="./images/logo.png" height="70" class="logoLCB" alt="Les Cordons Bleus">
             <span class="LCB align-middle"><span class="LCB_letter">L</span>es <span class="LCB_letter">C</span>ordons <span class="LCB_letter">B</span>leus</span>
         </a>
         <div class="collapse navbar-collapse" id="navbarCollapse">
             <div class="navbar-nav ml-auto" id="open_menu_nav">
                 <img src="./images/menu1.png" class="logoMenu" height="60" alt="login" style="font-size:30px;cursor:pointer" onclick="openNav()">
             </div>
         </div>
	     <!-- MENU caché -->
	     <div id="mySidenav" class="sidenav">
	        <hr class="barreMenu"/>
	  		<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
	  		<a href="index.html" id="accueil">Accueil</a>
	        <a href="javascript:update('mes_recettes');">Mes recettes</a>
	        <a href="javascript:update('mes_favoris');">Mes favoris</a>
	        <a href="">Paramètres</a>
	        <a href="connexion.html" id="bouton_connexion">Connexion</a>            
	        <a href="javascript:deconnexion()" id="bouton_deconnexion">Deconnexion</a>
		</div>
	 </nav>

    <!-- Liste mes recettes -->
    <div class="maCreationR">

        <!-- card -->
        <div class="card shadow p-3 mb-5 bg-white rounded">
            <div class="card-body cardR">
                <form id="formulaire">
                    <h1 class="text-center titreCardRecette">Ajouter une recette</h1>

                    <!-- partie Titre et nombre de personnes de la recette -->
                    <!-- Titre de la recette -->
                    <div class="form-group recetteTitre mt-5">
                        <label for="recetteTitre">Titre de la recette :</label>
                        <input type="text" class="form-control" id="recetteTitre" placeholder="titre">
                    </div>

                    <!-- Nombre de personnes -->
                    <div class="row">
                        <div class="form-group col-md-8">
                            <label for="inputState">Nombre de personnes : </label>
                            <select id="nbPers" class="form-control">
                                <option selected>Faites votre choix...</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                            </select>
                        </div>
                    </div>

                    <!-- Ajout d'une image -->
                    <div class="form-group ajoutImage">
                        <label for="urlImage">L'adresse URL de votre image : </label>
                        <input type="text" class="form-control" id="formControlFile" placeholder="URL de la photo">
                    </div>


                    <!--
                         image si Blob :
                        <form id="formulaire" method="POST" action="./data" enctype="multipart/form-data" onsubmit="envoyer(event)">
                            <input type="file" name="fileData" id="fileData"/>
                            <input  type="submit" />
                        </form>
                        <div class="container">
                            <div id="resultat" class="row">
                            </div>
                        </div>
                    -->


                    <p class="card-text titreinfo1R">Selectionnez vos ingrédients et la quantité :</p>
                    <div class="row">
                        <!-- liste groupe ingrédient -->
                        <div class="form-col-4">
                            <div class="col-auto my-4 form1">
                                <select class="custom-select mr-sm-2 select1" id="cat1">
                                    <option selected>Faites votre choix...</option>
                                </select>
                            </div>
                        </div>
                        <!-- liste sous groupe ingrédient -->
                        <div class="form-col-4">
                            <div class="col-auto my-4">
                                <select class="custom-select mr-sm-2 select2" id="cat2">
                                    <option selected>Faites votre choix...</option>
                                </select>
                            </div>
                        </div>
                        <!-- liste sous sous groupe ingrédient -->
                        <div class="form-col-4">
                            <div class="col-auto my-4">
                                <select class="custom-select mr-sm-2 select3" id="cat3">
                                    <option selected>Faites votre choix...</option>
                                </select>
                            </div>
                        </div>
                        <!-- liste ingrédient -->
                        <div class="form-col-4">
                            <div class="col-auto my-4">
                                <select class="custom-select mr-sm-2 select4" id="cat4">
                                    <option selected>Faites votre choix...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Poids -->
                    <div class="row">
                        <div class="col-4 poidsR">
                            <div class="input-group">
                                <input type="text" class="form-control poidsAlim" id="poidsAlim" aria-label="Text input with segmented dropdown button" placeholder="quantité">
                                <select class="form-control select5">
                                    <option value="1" selected>Grammes</option>
                                    <option value="2">Litres</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Validation -->
                    <div class="row">
                        <div class="col text-right">
                            <button type="submit" class="btn btn-success validIngredient">Valider</button>
                        </div>
                    </div>

                    <!-- Liste des ingrédients sélectionnés avec leur quantité -->
                    <div class="mt-5" id="conteneurListeIngredients">
                        <ul class="list-group list-group-flush conteneurListeIngredients"></ul>
                    </div>

                    <div class="tableauNutri">
                        <h2 class="titreTableau">Tableau nutritionnel</h2>
                        <div class="ctnr">
                            <div class="titrePpl">Nutriments par ingredients</div>
                            <div class="titre">Total des nutriments</div>
                            <div class="titre">Nutriments par personne</div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Energie (kcal)</div>
                            <div class="nut1" id="ener"></div>
                            <div class="nut2" id="totalEnergie"></div>
                            <div class="nut2" id="pPEner"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Eau (g)</div>
                            <div class="nut1" id="ea"></div>
                            <div class="nut2" id="totalEau"></div>
                            <div class="nut2" id="pPEa"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Protéines (g)</div>
                            <div class="nut1" id="prot"></div>
                            <div class="nut2" id="totalProteines"></div>
                            <div class="nut2" id="pPProt"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Glucides (g)</div>
                            <div class="nut1" id="gluc"></div>
                            <div class="nut2" id="totalGlucides"></div>
                            <div class="nut2" id="pPGluc"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Lipides (g)</div>
                            <div class="nut1" id="lipi"></div>
                            <div class="nut2" id="totalLipides"></div>
                            <div class="nut2" id="pPLipi"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Sucres (g)</div>
                            <div class="nut1" id="sucr"></div>
                            <div class="nut2" id="totalSucres"></div>
                            <div class="nut2" id="pPSucr"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Amidon (g)</div>
                            <div class="nut1" id="amid"></div>
                            <div class="nut2" id="totalAmidon"></div>
                            <div class="nut2" id="pPAmid"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Fibres alimentaires (g)</div>
                            <div class="nut1" id="fibr"></div>
                            <div class="nut2" id="totalFibresAlimentaires"></div>
                            <div class="nut2" id="pPFibr"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Cholesterol (mg)</div>
                            <div class="nut1" id="chol"></div>
                            <div class="nut2" id="totalCholesterol"></div>
                            <div class="nut2" id="pPChol"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Sel (g)</div>
                            <div class="nut1" id="se"></div>
                            <div class="nut2" id="totalSel"></div>
                            <div class="nut2" id="pPSe"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Calcium (mg)</div>
                            <div class="nut1" id="calc"></div>
                            <div class="nut2" id="totalCalcium"></div>
                            <div class="nut2" id="pPCalc"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Fer (mg)</div>
                            <div class="nut1" id="fe"></div>
                            <div class="nut2" id="totalFer"></div>
                            <div class="nut2" id="pPFe"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Iode (µg)</div>
                            <div class="nut1" id="iod"></div>
                            <div class="nut2" id="totalIode"></div>
                            <div class="nut2" id="pPIod"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Béta Carotène (µg)</div>
                            <div class="nut1" id="beta"></div>
                            <div class="nut2" id="totalBetaCarotene"></div>
                            <div class="nut2" id="pPBeta"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Vitamine D (µg)</div>
                            <div class="nut1" id="vitD"></div>
                            <div class="nut2" id="totalVitamineD"></div>
                            <div class="nut2" id="pPVitD"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Vitamine E (mg)</div>
                            <div class="nut1" id="vitE"></div>
                            <div class="nut2" id="totalVitamineE"></div>
                            <div class="nut2" id="pPVitE"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Vitamine C (mg)</div>
                            <div class="nut1" id="vitC"></div>
                            <div class="nut2" id="totalVitamineC"></div>
                            <div class="nut2" id="pPVitC"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Vitamine B1 (mg)</div>
                            <div class="nut1" id="vitB1"></div>
                            <div class="nut2" id="totalVitamineB1"></div>
                            <div class="nut2" id="pPVitB1"></div>
                        </div>
                        <div class="ctnr">
                            <div class="nomNut">Vitamine B12 (µg)</div>
                            <div class="nut1" id="vitB12"></div>
                            <div class="nut2" id="totalVitamineB12"></div>
                            <div class="nut2" id="pPVitB12"></div>
                        </div>
                    </div>

                    <!-- Partie préparation -->
                    <div class="recettePreparation">
                        <div class="form-group">
                            <label class="titreinfo1R" for="exampleFormControlTextarea1">Préparation :</label>
                            <textarea class="form-control" id="prepaRecette" rows="5" placeholder="instructions..."></textarea>
                        </div>
                    </div>



                    <!-- Validation Recette -->
                    <div class="row mt-5">
                        <div class="col validAjouR text-right">
                            <button type="button" id="validRecette" class="btn btn-success btn-lg btn-block" onclick="valideRecette()">Valider votre recette</button>
                        </div>
                    </div>

                    <!--
                    Validation et annulation preparation
                    <div class="d-flex justify-content-end align-items-center">
                        <input class="btn btn-danger resetPrepa" type="reset" value="Annuler">
                        <input class="btn btn-success validPrepa" type="submit" value=" Valider ">
                    </div>
                    -->

                </form>
            </div>
        </div>
    </div>



		<!-- Footer en mode Desktop-->
        <div class="footerDesktop">
            <div class="footertext1">made with <span class="love">♥</span> by LCB
            </div>
            <div class="footertext-links">
                <p>Tous droits réservés Les Cordons Bleus - 2019</br>
                    Vous avez une question ? <a href="">nous contacter</a> ∗
                    <a href="">Mentions légales</a> ∗
                    <a href="">Conditions Générales d'Utilisation</a> ∗
                    <a href="">Contact</a> ∗
                    <a href="">Politique de protection des données personnelles</a> ∗
                    <a href="">Politique de confidentialité</a>
                </p>
            </div>
        </div>
        <!-- Navbar bottom format mobile xs -->
        <nav class="navbar navbarbottom fixed-bottom navbar-light bg-light">
            <a href="index.html" class="nav-item nav-link"><img src="./images/nav_home.png" height="40" alt="login"></a>
            <a href="#" class="nav-item nav-link"><img src="./images/nav_heart.png" height="40" alt="login"></a>
            <a href="connexion.html" class="nav-item nav-link"><img src="./images/nav_user.png" height="40" alt="login"></a>
            <a href="#" class="nav-item nav-link"><img src="./images/nav_engrenage.png" height="45" alt="login"></a>
        </nav>


    <script>

        var poids;
        var ingredientValue;
        var unite;
        var proprietesIngredient;
        var titreRecette;
        var prepaRecette;
        var ingredients;
        var idIng;
        var listQuantites = [];
        var image;
        var ArrayIdIngredient = [];

        recupListes();

        function recupListes() {
            var liste;
            var numListe;
            var value1;
            var value2;
            var value3;
            var value4;

            // tableaux recupération ingredients
            $.ajax({
                type: 'get',
                contentType: "application/json",
                url: "http://localhost:8080/groupe/all/",
            }).done(function (data) {
                datas = data;

                // liste 1 groupe ingrédient
                numListe = 1;
                for (var i = 0; i < datas.length; i++) {

                    var titre1 = datas[i].lib;
                    $(".select" + numListe).append("<option type=text value=" + i + " onclick=selectListe1()>" + titre1 + "</option>");
                }

                // Récupération valeur 1ère liste :
                $(".select1").on('change', function () {
                    value1 = $(this).val();
                    $(".select2").empty();
                    $(".select3").empty();
                    $(".select4").empty();

                    // liste 2 sous groupe ingrédient
                    numListe = 2;
                    $(".select" + numListe).append("<option selected>Faites votre choix...</option>");
                    for (var j = 0; j < datas[value1].sousGroupeIngredient.length; j++) {
                        var titre2 = datas[value1].sousGroupeIngredient[j].lib;
                        $(".select" + numListe).append("<option type=text value=" + j + " onclick=selectListe2()>" + titre2 + "</option>");
                    }

                    // Récupération valeur 2ème liste :
                    $('.select2').on('change', function () {
                        value2 = $(this).val();
                        $(".select3").empty();
                        $(".select4").empty();

                        // liste 3 sous sous groupe ingrédient
                        numListe = 3;
                        $(".select" + numListe).append("<option selected>Faites votre choix...</option>");
                        for (var k = 0; k < datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient.length; k++) {
                            var titre3 = datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[k].lib;
                            $(".select" + numListe).append("<option type=text value=" + k + " onclick=selectListe3()>" + titre3 + "</option>");
                        }

                        // Récupération valeur 3ème liste :
                        $('.select3').on('change', function () {
                            value3 = $(this).val();
                            $(".select4").empty();

                            // liste 4 ingrédient
                            numListe = 4;
                            $(".select" + numListe).append("<option selected>Faites votre choix...</option>");
                            for (var l = 0; l < datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[value3].ingredients.length; l++) {

                                var titre4 = datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[value3].ingredients[l].alimNom;
                                $(".select" + numListe).append("<option type=text id=" + l + " value=" + l + " onclick=selectListe3()>" + titre4 + "</option>");
                            }

                            // Récupération valeur 4ème liste :
                            $('.select4').on('change', function () {
                                value4 = $(this).val();
                                ingredientValue = datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[value3].ingredients[value4].alimNom;
                                proprietesIngredient = datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[value3].ingredients[value4];
                                idIng = datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[value3].ingredients[value4].idIngredient;
                                console.log(idIng);
                                $(".validIngredient").click(function (event) {
                                    event.preventDefault();
                                })
                            })
                        })
                    })
                })
            })

        }

        // VALIDATION DE LA RECETTE : RECUPERATION DES DONNEES ET ENVOIE DE LA REQUETE AJAX

        /*
        // image si Blob :
         function envoyer(e){
         e.preventDefault();
         var form = $('#formulaire')[0];
         var data = new FormData(form);
         $.ajax({
             type: "POST",
             enctype: 'multipart/form-data',
             url: "/data",
             data: data,
             processData: false,
             contentType: false,
             cache: false,
             timeout: 600000,
             success: function (data) {
                 console.log(data);
                 $("body").append("<img src='./data/"+data+"' />");
             },
             error: function (e) {
                 alert("Oups !");
             }
         });
     }
     $.ajax({
         url: "./recette/all",
     }).done(function(data) {
         data.forEach(function(d){
             $("#resultat").append("<div class='recette col-sm-3'>"+d.nom+"</div>");
         });
     })
     */











        //$("#validRecette").click //


        function valideRecette() {
            event.preventDefault();
            regroupeAttributs();
            console.log(listQuantites);
            console.log(ArrayIdIngredient);

            $.ajax({
                type: 'POST',
                url: "http://localhost:8080/recette/nouv_recette",
                headers: {
                    "mail": sessionStorage.getItem('Mail'),
                    "lib": titreRecette,
                    "nbrPer": nbPersonnes,
                    "description": prepaRecette,
                    "listIngr": ArrayIdIngredient,
                    "listQuant": listQuantites,
                    "image": image
                },
                dataType: "json",
                timeout: 15000
            }).done(function (data) {
                console.log(data);
                alert("Votre recette a été enregistrée avec succès !");
            }).fail(function (jqXHR, textStatus, errorThrown) {
                alert("Votre recette a été enregistrée avec succès !");

                document.location.href = "mes_recettes.html";
            });
        }

        // REGROUPE LES ATTRIBUTS NECESSAIRES POUR LA REQUETE AJAX
        function regroupeAttributs() {
            titreRecette = $("#recetteTitre").val();
            nbPersonnes = parseInt($("#nbPers").val());
            prepaRecette = $("#prepaRecette").val();
            ingredients = $(".ingredients");
            quantites = $(".quantites");
            image = $("#formControlFile").val();

            for (var i = 0; i < ingredients.length; i++) {
                var nomIngredient = ingredients[i].childNodes[0].data;
                $.ajax({
                    url: "http://localhost:8080/ingredient/unique",
                    headers: { "nomIngredient": nomIngredient },
                    type: 'GET',
                    dataType: "json",
                    timeout: 15000
                }).done(function (data) {
                    console.log(data);


                }).fail(function () {
                    console.log("erreur dans la recherche de l'ingredient");
                });

                listQuantites.push(parseInt(quantites[i].childNodes[0].data));
                ArrayIdIngredient.push(parseInt($('.hidden')[i].childNodes[0].data));
            }

        }

        // AFFICHAGE DE LA LISTE DES INGREDIENTS
        $(".validIngredient").click(function (event) {
            poids = $(".poidsAlim").val();
            unite = $(".select5").val();
            nbPersonnes = $("#nbPers").val();
            if (nbPersonnes == "Faites votre choix...") {
                nbPersonnes = 1;
            } else {
                nbPersonnes = parseInt(nbPersonnes);
            }

            if (unite == 1) {
                unite = "grammes";
            } else if (unite == 2) {
                unite = "litres";
            } else {
                unite = "";
                poids = "";
            }
            afficheIngredient();
            afficheTableauNutritionnel();
            calculTotalNutriments();

        })



        // AFFICHAGE DE LA LISTE DES INGREDIENTS
        function afficheIngredient() {
            if (unite == "") {
                $(".conteneurListeIngredients").append('<li class="list-group-item listeIngredient"><div class="ingredients">' + ingredientValue + '</di></li>');
            } else {
                console.log(idIng);
                $(".conteneurListeIngredients").append('<li class="list-group-item listeIngredient"><div class="quantites">' + poids + "</div> " + unite + " de <div class='ingredients'>" + ingredientValue + "</div> <div class='hidden'>" + idIng + "</div></li>");
            }
        }
        // REMPLISSAGE DU TABLEAU CONTENANT TOUTES LES VALEURS NUTRITIONNELLES PAR INGREDIENT ET EN FONCTION DE LA QUANTITE
        function afficheTableauNutritionnel() {
            $("#amid").append("<div class='nutri amidon'>" + tronque(proprietesIngredient.amidon / 100 * poids) + "</div>");
            $("#beta").append("<div class='nutri betaCarotene'>" + tronque(proprietesIngredient.betaCarotene / 100 * poids) + "</div>");
            $("#calc").append("<div class='nutri calcium'>" + tronque(proprietesIngredient.calcium / 100 * poids) + "</div>");
            $("#chol").append("<div class='nutri cholesterol'>" + tronque(proprietesIngredient.cholosterol / 100 * poids) + "</div>");
            $("#ea").append("<div class='nutri eau'>" + tronque(proprietesIngredient.eau / 100 * poids) + "</div>");
            $("#ener").append("<div class='nutri energie'>" + tronque(proprietesIngredient.energie / 100 * poids) + "</div>");
            $("#fe").append("<div class='nutri fer'>" + tronque(proprietesIngredient.fer / 100 * poids) + "</div>");
            $("#fibr").append("<div class='nutri fibresAlimentaires'>" + tronque(proprietesIngredient.fibresAlimentaires / 100 * poids) + "</div>");
            $("#gluc").append("<div class='nutri glucides'>" + tronque(proprietesIngredient.glucides / 100 * poids) + "</div>");
            $("#iod").append("<div class='nutri iode'>" + tronque(proprietesIngredient.iode / 100 * poids) + "</div>");
            $("#lipi").append("<div class='nutri lipides'>" + tronque(proprietesIngredient.lipides / 100 * poids) + "</div>");
            $("#prot").append("<div class='nutri proteines'>" + tronque(proprietesIngredient.proteines / 100 * poids) + "</div>");
            $("#se").append("<div class='nutri sel'>" + tronque(proprietesIngredient.sel / 100 * poids) + "</div>");
            $("#sucr").append("<div class='nutri sucres'>" + tronque(proprietesIngredient.sucres / 100 * poids) + "</div>");
            $("#vitB1").append("<div class='nutri vitamineB1'>" + tronque(proprietesIngredient.vitamineB1 / 100 * poids) + "</div>");
            $("#vitB12").append("<div class='nutri vitamineB12'>" + tronque(proprietesIngredient.vitamineB12 / 100 * poids) + "</div>");
            $("#vitC").append("<div class='nutri vitamineC'>" + tronque(proprietesIngredient.vitamineC / 100 * poids) + "</div>");
            $("#vitD").append("<div class='nutri vitamineD'>" + tronque(proprietesIngredient.vitamineD / 100 * poids) + "</div>");
            $("#vitE").append("<div class='nutri vitamineE'>" + tronque(proprietesIngredient.vitamineE / 100 * poids) + "</div>");

        }

        // CALCUL DU TOTAL PAR NUTRIMENT DE LA RECETTE
        function calculTotalNutriments() {

            var totalAmidon = 0;
            var totalBetaCarotene = 0;
            var totalCalcium = 0;
            var totalCholesterol = 0;
            var totalEau = 0;
            var totalEnergie = 0;
            var totalFer = 0;
            var totalFibresAlimentaires = 0;
            var totalGlucides = 0;
            var totalIode = 0;
            var totalLipides = 0;
            var totalProteines = 0;
            var totalSel = 0;
            var totalSucres = 0;
            var totalVitamineB1 = 0;
            var totalVitamineB12 = 0;
            var totalVitamineC = 0;
            var totalVitamineD = 0;
            var totalVitamineE = 0;
            var amidon = $(".amidon");
            var betaCarotene = $(".betaCarotene");
            var calcium = $(".calcium");
            var cholesterol = $(".cholesterol");
            var eau = $(".eau");
            var energie = $(".energie");
            var fer = $(".fer");
            var fibresAlimentaires = $(".fibresAlimentaires");
            var glucides = $(".glucides");
            var iode = $(".iode");
            var lipides = $(".lipides");
            var proteines = $(".proteines");
            var sel = $(".sel");
            var sucres = $(".sucres");
            var vitamineB1 = $(".vitamineB1");
            var vitamineB12 = $(".vitamineB12");
            var vitamineC = $(".vitamineC");
            var vitamineD = $(".vitamineD");
            var vitamineE = $(".vitamineE");




            for (var i = 0; i < amidon.length; i++) {
                totalAmidon = totalAmidon + parseFloat(amidon[i].childNodes[0].data);
                totalBetaCarotene = totalBetaCarotene + parseFloat(betaCarotene[i].childNodes[0].data);
                totalCalcium = totalCalcium + parseFloat(calcium[i].childNodes[0].data);
                totalCholesterol = totalCholesterol + parseFloat(cholesterol[i].childNodes[0].data);
                totalEau = totalEau + parseFloat(eau[i].childNodes[0].data);
                totalEnergie = totalEnergie + parseFloat(energie[i].childNodes[0].data);
                totalFer = totalFer + parseFloat(fer[i].childNodes[0].data);
                totalFibresAlimentaires = totalFibresAlimentaires + parseFloat(fibresAlimentaires[i].childNodes[0].data);
                totalGlucides = totalGlucides + parseFloat(glucides[i].childNodes[0].data);
                totalIode = totalIode + parseFloat(iode[i].childNodes[0].data);
                totalLipides = totalLipides + parseFloat(lipides[i].childNodes[0].data);
                totalProteines = totalProteines + parseFloat(proteines[i].childNodes[0].data);
                totalSel = totalSel + parseFloat(sel[i].childNodes[0].data);
                totalSucres = totalSucres + parseFloat(sucres[i].childNodes[0].data);
                totalVitamineB1 = totalVitamineB1 + parseFloat(vitamineB1[i].childNodes[0].data);
                totalVitamineB12 = totalVitamineB12 + parseFloat(vitamineB12[i].childNodes[0].data);
                totalVitamineC = totalVitamineC + parseFloat(vitamineC[i].childNodes[0].data);
                totalVitamineD = totalVitamineD + parseFloat(vitamineD[i].childNodes[0].data);
                totalVitamineE = totalVitamineE + parseFloat(vitamineE[i].childNodes[0].data);

            }


            $(".total").remove();
            $("#totalAmidon").append("<div class='total'>" + tronque(totalAmidon) + "</div>");
            $("#totalBetaCarotene").append("<div class='total'>" + tronque(totalBetaCarotene) + "</div>");
            $("#totalCalcium").append("<div class='total'>" + tronque(totalCalcium) + "</div>");
            $("#totalCholesterol").append("<div class='total'>" + tronque(totalCholesterol) + "</div>");
            $("#totalEau").append("<div class='total'>" + tronque(totalEau) + "</div>");
            $("#totalEnergie").append("<div class='total'>" + tronque(totalEnergie) + "</div>");
            $("#totalFer").append("<div class='total'>" + tronque(totalFer) + "</div>");
            $("#totalFibresAlimentaires").append("<div class='total'>" + tronque(totalFibresAlimentaires) + "</div>");
            $("#totalGlucides").append("<div class='total'>" + tronque(totalGlucides) + "</div>");
            $("#totalIode").append("<div class='total'>" + tronque(totalIode) + "</div>");
            $("#totalLipides").append("<div class='total'>" + tronque(totalLipides) + "</div>");
            $("#totalProteines").append("<div class='total'>" + tronque(totalProteines) + "</div>");
            $("#totalSel").append("<div class='total'>" + tronque(totalSel) + "</div>");
            $("#totalSucres").append("<div class='total'>" + tronque(totalSucres) + "</div>");
            $("#totalVitamineB1").append("<div class='total'>" + tronque(totalVitamineB1) + "</div>");
            $("#totalVitamineB12").append("<div class='total'>" + tronque(totalVitamineB12) + "</div>");
            $("#totalVitamineC").append("<div class='total'>" + tronque(totalVitamineC) + "</div>");
            $("#totalVitamineD").append("<div class='total'>" + tronque(totalVitamineD) + "</div>");
            $("#totalVitamineE").append("<div class='total'>" + tronque(totalVitamineE) + "</div>");

            $(".pP").remove();
            $("#pPEner").append("<div class='pP'>" + tronque(totalEnergie / nbPersonnes) + "</div>");
            $("#pPEa").append("<div class='pP'>" + tronque(totalEau / nbPersonnes) + "</div>");
            $("#pPProt").append("<div class='pP'>" + tronque(totalProteines / nbPersonnes) + "</div>");
            $("#pPGluc").append("<div class='pP'>" + tronque(totalGlucides / nbPersonnes) + "</div>");
            $("#pPLipi").append("<div class='pP'>" + tronque(totalLipides / nbPersonnes) + "</div>");
            $("#pPSucr").append("<div class='pP'>" + tronque(totalSucres / nbPersonnes) + "</div>");
            $("#pPAmid").append("<div class='pP'>" + tronque(totalAmidon / nbPersonnes) + "</div>");
            $("#pPFibr").append("<div class='pP'>" + tronque(totalFibresAlimentaires / nbPersonnes) + "</div>");
            $("#pPChol").append("<div class='pP'>" + tronque(totalCholesterol / nbPersonnes) + "</div>");
            $("#pPSe").append("<div class='pP'>" + tronque(totalSel / nbPersonnes) + "</div>");
            $("#pPCalc").append("<div class='pP'>" + tronque(totalCalcium / nbPersonnes) + "</div>");
            $("#pPFe").append("<div class='pP'>" + tronque(totalFer / nbPersonnes) + "</div>");
            $("#pPIod").append("<div class='pP'>" + tronque(totalIode / nbPersonnes) + "</div>");
            $("#pPBeta").append("<div class='pP'>" + tronque(totalBetaCarotene / nbPersonnes) + "</div>");
            $("#pPVitD").append("<div class='pP'>" + tronque(totalVitamineD / nbPersonnes) + "</div>");
            $("#pPVitE").append("<div class='pP'>" + tronque(totalVitamineE / nbPersonnes) + "</div>");
            $("#pPVitC").append("<div class='pP'>" + tronque(totalVitamineC / nbPersonnes) + "</div>");
            $("#pPVitB1").append("<div class='pP'>" + tronque(totalVitamineB1 / nbPersonnes) + "</div>");
            $("#pPVitB12").append("<div class='pP'>" + tronque(totalVitamineB12 / nbPersonnes) + "</div>");
        }
        function tronque(nombre) {
            return Math.round(nombre * 1000) / 1000;
        }

    </script>
</body>
</html>
