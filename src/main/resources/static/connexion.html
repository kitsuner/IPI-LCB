<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="javascriptLCB.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    </script>
	<!-- Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Font+Name">
    <style>@import url('https://fonts.googleapis.com/css?family=Amaranth|Baloo|Cairo|Freckle+Face|Itim&display=swap');</style>
      
	<title>Connexion</title>
</head>

  <body>
     <!-- NAVBAR top -->
     <nav class="navbar navbartop navbar-expand-sm navbar-light">
         <a href="index.html" class="navbar-brand">
             <img src="./images/logo.png" height="70" class="logoLCB" alt="Les Cordons Bleus">
             <span class="LCB align-middle"><span class="LCB_letter">L</span>es <span class="LCB_letter">C</span>ordons <span class="LCB_letter">B</span>leus</span>
         </a>
         <div class="collapse navbar-collapse" id="navbarCollapse">
             <div class="navbar-nav ml-auto" id="open_menu_nav">
                 <img src="./images/menu1.png" class="logoMenu" height="60" alt="login" style="font-size:30px;cursor:pointer" onclick="openNav()">
             </div>
         </div>
	     <!-- MENU caché -->
	     <div id="mySidenav" class="sidenav">
	        <hr class="barreMenu"/>
	  		<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
	  		<a href="index.html" id="accueil">Accueil</a>
	        <a href="javascript:update('mes_recettes');">Mes recettes</a>
	        <a href="javascript:update('mes_favoris');">Mes favoris</a>
	        <a href="">Paramètres</a>
	        <a href="connexion.html" id="bouton_connexion">Connexion</a>            
	        <a href="javascript:deconnexion()" id="bouton_deconnexion">Deconnexion</a>
		</div>
	 </nav>

    <div class="container d-flex align-items-center main_connexion my-5" >
            <div class="row p-2 col-md-7 col-lg-6 bg-light" id="connexion_form" >
                <div class="statique col-12 my-2 "> 
                    <a class="my-2 py-3 text-center" href="creer_compte.html" id="have_account">J'ai déjà un compte</a>
                </div>
                <div id="connexion" class="row mb-4 justify-content-center">
                    <h1 class="titreConnexion text-center">Connexion</h1>
                    <input class="email col-10 my-2" id="idUtilisateur" type="email" placeholder="Adresse mail">
                    <input class="pswd col-10 my-2" id="motDePasse" type="password" placeholder="Mot de passe">
                    <button class="btn-success col-10 border rounded my-3" name="connecter">Valider</button>
                </div>
            </div>
        
            <div  class="row p-2 col-md-7 col-lg-6 mt-5 bg-light" id="cree_compte_form">
                <div class="statique col-12 my-2" id="connexion_statique"> 
                    <a class="my-2 py-3 text-center" href="creer_compte.html" id="create_account">Créer un compte</a>
                </div>
                <div id="cree_compte" class="row mb-4 justify-content-center">
                    <h1 class="titreConnexion text-center">Créer un compte</h1>
                    <input class="user col-10 my-2" type="text" placeholder="Prénom" id="prenomNew">
                    <input class="user col-10 my-2" type="text" placeholder="Nom" id="nomNew">
                    <input class="user col-10 my-2" type="text" placeholder="Pseudonyme" id="pseudoNew">
                    <input class="email col-10 my-2" type="email"  placeholder="Adresse mail" id="mailNew">
                    <input class="pswd col-10 my-2" type="password" placeholder="Mot de passe"id="passwordNew">
                    <input class="pswd col-10 my-2" type="password" placeholder="Confirmer le mot de passe">
                    <div class="custom-control custom-checkbox col-10 my-2">
                        <input type="checkbox" class="custom-control-input " id="customCheck1">
                        <label class="custom-control-label" for="customCheck1">remember my password</label>
                    </div>
                    <button class="btn-success col-10 offset-1 border rounded my-3 creerUnCompte" name="creerUnCompte">Valider</button>
                </div>
            </div>
        </div>


        <!-- Footer en mode Desktop-->
        <div class="footerDesktop">
            <div class="footertext1">made with <span class="love">♥</span> by LCB
            </div>
            <div class="footertext-links">
                <p>Tous droits réservés Les Cordons Bleus - 2019</br>
                    Vous avez une question ? <a href="">nous contacter</a> ∗
                    <a href="">Mentions légales</a> ∗
                    <a href="">Conditions Générales d'Utilisation</a> ∗
                    <a href="">Contact</a> ∗
                    <a href="">Politique de protection des données personnelles</a> ∗
                    <a href="">Politique de confidentialité</a>
                </p>
            </div>
        </div>
        <!-- Navbar bottom format mobile xs -->
        <nav class="navbar navbarbottom fixed-bottom navbar-light bg-light">
            <a href="index.html" class="nav-item nav-link"><img src="./images/nav_home.png" height="40" alt="login"></a>
            <a href="#" class="nav-item nav-link"><img src="./images/nav_heart.png" height="40" alt="login"></a>
            <a href="connexion.html" class="nav-item nav-link"><img src="./images/nav_user.png" height="40" alt="login"></a>
            <a href="#" class="nav-item nav-link"><img src="./images/nav_engrenage.png" height="45" alt="login"></a>
        </nav>
    
    	
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>

        <script>
        	let tokenMail = null;
        	let tokenPassword = null;
            $(document).ready(function() {
                $("#connexion_form>.statique").hide();
                $("#cree_compte").hide();            
            });
        
            
            $("#create_account").click(function( event ) {
                event.preventDefault();
                $("#connexion_form> .statique").toggle();
                $("#connexion").slideUp();
                $("#cree_compte").slideDown();
                $("#cree_compte_form> .statique").toggle();
            });
    
            $("#have_account").click(function( event ) {
                event.preventDefault();
                $("#cree_compte_form> .statique").toggle();
                $("#cree_compte").slideUp();
                $("#connexion").slideDown();
                $("#connexion_form> .statique").toggle();
            }); 


            
            
            

            $("button[name='connecter']").on("click",function(){

                var idUtilisateur = $("#idUtilisateur").val();
                var motDePasse = $("#motDePasse").val();
                console.log(idUtilisateur);
                $.ajax({ 
                    url: "http://localhost:8080/utilisateur/connexion", 
                    headers: { "mail" : idUtilisateur , "password" : motDePasse},
                    type: 'GET',
                    dataType:"json",
                    timeout: 15000
                }).done(
                    function(data) { 
                        
                        tokenMail = idUtilisateur;
                        tokenPassword = motDePasse;
                        saveConnexion();
                        document.location.href="mes_recettes.html";
                    }
                ).fail(function(jqXHR, textStatus, errorThrown){
                    alert("Connexion impossible. Cause probable : erreur sur le pseudonyme ou sur le mot de passe");
                });
            })

            $("button[name='creerUnCompte']").on("click",function(){
                var pseudoNew = $("#pseudoNew").val();
                var prenomNew = $("#prenomNew").val();
                var nomNew = $("#nomNew").val();
                var mailNew = $("#mailNew").val();
                var passwordNew = $("#passwordNew").val();
                
                $.ajax({
                    url: "http://localhost:8080/utilisateur",
                    type: 'POST',
                    headers: { "pseudo" : pseudoNew , "mail" : mailNew , "motDePasse" : passwordNew , "prenom" : prenomNew , "nom" : nomNew }                    
                }).done(function(data){                                        
                    alert("Votre compte a bien été créé !")
                }).fail(function(jqXHR, textStatus, errorThrown){
                    alert("Nous n'avons pas pu créer votre compte. Cause probable : le pseudonyme est déjà utilisé");
                });
            })

            function saveConnexion(){
            	window.sessionStorage.setItem('Mail', tokenMail);
            	window.sessionStorage.setItem('Password', tokenPassword);
            }
        </script>
  </body>
</html>
